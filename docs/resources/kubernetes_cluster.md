---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "civo_kubernetes_cluster Resource - terraform-provider-civo"
subcategory: "Civo Kubernetes"
description: |-
  Provides a Civo Kubernetes cluster resource. This can be used to create, delete, and modify clusters.
---

# civo_kubernetes_cluster (Resource)

Provides a [Civo Kubernetes](https://www.civo.com/docs/kubernetes) cluster resource. This can be used to create, delete, and modify clusters.

## Example Usage

* View clusters after creation on the [CLI](https://www.civo.com/docs/overview/civo-cli):
```
civo kubernetes ls
```
* View clusters after creation on the [Dashboard](https://dashboard.civo.com/kubernetes)
* View node sizes on [CLI](https://www.civo.com/docs/overview/civo-cli):

```
civo kubernetes size
```

### Simplest, and cheapest 3 node k3s cluster

With the following configuration a cluster of three nodes gets created with the following defaults:

* randomly generated name
* k3s cluster type
* default network

```terraform
provider "civo" {
  region = "LON1"
}


data "civo_firewall" "example" {
    name = "default-default"
}

# Cluster name is randomly generated when not specified

resource "civo_kubernetes_cluster" "example" {

    # Default firewall in the default network:
    firewall_id = data.civo_firewall.example.id
    pools {
        size = "g4s.kube.xsmall"
        node_count = 3
    }
}

output "kubernetes_name" {
  value = civo_kubernetes_cluster.example.name
  description = "The randomly generated name for this cluster"

}
```

### 3 small nodes, with apps and network on kubernetes talos cluster

To view a list of apps bundle with our Kubernetes cluster:

* [CLI](https://www.civo.com/docs/overview/civo-cli) --> `civo kubernetes apps ls`
* [Civo Marketplace](https://www.civo.com/marketplace)

```terraform
provider "civo" {
  region = "LON1"
}

resource "civo_firewall" "example" {
    name = "example-firewall"
    create_default_rules = true
    network_id = civo_network.example.id

}

resource "civo_network" "example" {
  label = "example-network"

}


resource "civo_kubernetes_cluster" "example" {
    name = "example-cluster"
    applications = "argocd,linkerd:Linkerd with Dashboard & Jaeger"
    network_id = civo_network.example.id
    firewall_id = civo_firewall.example.id

    cluster_type = "talos"
    pools {
        label = "shop"
        size = "g4s.kube.small"
        node_count = 3
    }
}
```

~> **Note:** At the time of writing this document, application updates are **not** supported in Terraform. Also, applications that require volumes will be created as part of the cluster creation but they will not be deleted once the cluster is destroyed by Terraform

### 3 medium nodes and writing the kubeconfig to a file for kubectl

This example shows how to output the configuration of the cluster to a kubeconfig file and then use that with the kubernetes provider to create a namespace.

We will also enter a `kubernetes_version`. To see the list of kubernetes version use the  [Civo CLI](https://www.civo.com/docs/overview/civo-cli) command:
```
civo kubernetes version
```

~> **Careful!** The `kubeconfig` file will have the credentials to your cluster, take care not to commit it to a public repository or store it somewhere unsafe. 


```terraform
provider "civo" {
  region = "LON1"
}

resource "civo_firewall" "example" {
    name = "example-firewall"
    create_default_rules = true
    network_id = civo_network.example.id
}

resource "civo_network" "example" {
  label = "example-network"
}

resource "civo_kubernetes_cluster" "example" {
    name = "example-cluster"
    write_kubeconfig = true
    network_id = civo_network.example.id
    firewall_id = civo_firewall.example.id
    kubernetes_version = "1.28.7-k3s1"
    pools {
        label = "shop"
        size = "g4s.kube.medium"
        node_count = 3
    }
}

resource "local_file" "kubeconfig" {
  filename = "/tmp/${civo_kubernetes_cluster.example.name}-kubeconfig"  # Define the path and file name
  content  = civo_kubernetes_cluster.example.kubeconfig
}


provider "kubernetes" {
  config_path    = local_file.kubeconfig.filename
}

resource "kubernetes_namespace" "example" {
  depends_on = [local_file.kubeconfig]
  metadata {
    name = "example-namespace"
  }
}
```

The user can then run the following `kubectl` command to see the namespace created:

```
kubectl --kubeconfig=/tmp/example-cluster-kubeconfig get ns
```

Unless you need to use terraform to configure your cluster, you can also access [Civo CLI](https://www.civo.com/docs/overview/civo-cli) and running the following, to automatically configure kubectl:

```
civo kubernetes config example-cluster --save --switch
```

This will prevent saving kubeconfig to state.

## Argument Reference

### Required

- `firewall_id` (String) The existing firewall ID to use for this cluster
- `pools` (Block List, Min: 1, Max: 1) (see [below for nested schema](#nestedblock--pools))

<a id="nestedblock--pools"></a>
#### Nested Schema for `pools`

Required:

- `node_count` (Number) Number of nodes in the nodepool
- `size` (String) Size of the nodes in the nodepool. View node sizes on the [Civo CLI](https://www.civo.com/docs/overview/civo-cli) --> `civo kubernetes size`

Optional:

- `label` (String) Node pool label, if you don't provide one, we will generate one for you
- `labels` (Map of String)
- `public_ip_node_pool` (Boolean) Node pool belongs to the public ip node pool
- `taint` (Block Set) (see [below for nested schema](#nestedblock--pools--taint))

Read-Only Output:

- `instance_names` (List of String) Instance names in the nodepool

<a id="nestedblock--pools--taint"></a>
##### Nested Schema for `pools.taint`

Required:

- `effect` (String)
- `key` (String)
- `value` (String)

### Optional

- `applications` (String) Comma separated list of applications to install. Spaces within application names are fine, but shouldn't be either side of the comma. Application names are case-sensitive; the available applications can be listed with the Civo CLI: 'civo kubernetes applications ls'. If you want to remove a default installed application, prefix it with a '-', e.g. -Traefik. For application that supports plans, you can use 'app_name:app_plan' format e.g. 'Linkerd:Linkerd & Jaeger' or 'MariaDB:5GB'. View list of apps on the [Civo CLI](https://www.civo.com/docs/overview/civo-cli) --> `civo kubernetes apps ls`
- `cluster_type` (String) The type of cluster to create, valid options are `k3s` or `talos` the default is `k3s`
- `cni` (String) The cni for the k3s to install (the default is `flannel`) valid options are `cilium` or `flannel`
- `kubernetes_version` (String) The version of k3s to install (optional, the default is currently the latest stable available)
- `name` (String) Name for your cluster, must be unique within your account
- `network_id` (String) The network for the cluster, if not declare we use the default one
- `num_target_nodes` (Number, Deprecated) The number of instances to create (optional, the default at the time of writing is 3)
- `region` (String) The region for the cluster, if not declare we use the region in declared in the provider
- `tags` (String) Space separated list of tags, to be used freely as required
- `target_nodes_size` (String, Deprecated) The size of each node (optional, the default is currently g4s.kube.medium)
- `timeouts` (Block, Optional) (see [below for nested schema](#nestedblock--timeouts)) defines timeouts for cluster creation, read and update, default is 30 minutes for all
- `write_kubeconfig` (Boolean) (false by default) when set to true, `kubeconfig` is saved to the terraform state file

<a id="nestedblock--timeouts"></a>
#### Nested Schema for `timeouts`

Optional:

- `create` (String) sets timeout for cluster creation - default 30 minutes
- `delete` (String) sets timeout for cluster deletion - default 30 minutes
- `update` (String) sets timeout for cluster update - default 30 minutes


## Attributes Reference

- `api_endpoint` (String) The API server endpoint of the cluster
- `created_at` (String) The timestamp when the cluster was created
- `dns_entry` (String) The DNS name of the cluster
- `id` (String) The ID of this resource.
- `installed_applications` (List of Object) (see [below for nested schema](#nestedatt--installed_applications))
- `kubeconfig` (String, Sensitive) The kubeconfig of the cluster
- `master_ip` (String) The IP address of the master node
- `ready` (Boolean) When cluster is ready, this will return `true`
- `status` (String) Status of the cluster

<a id="nestedatt--installed_applications"></a>
#### Nested Schema for `installed_applications`

Read-Only Outputs:

- `application` (String) name of the application
- `category` (String) category of the application
- `installed` (Boolean) whether application is installed or not
- `version` (String) version of the application


## Import

Import is supported using the following syntax:

```shell
# using ID
terraform import civo_kubernetes_cluster.my-cluster 1b8b2100-0e9f-4e8f-ad78-9eb578c2a0af
```
